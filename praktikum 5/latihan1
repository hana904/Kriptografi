class VigenereCipher:
    """
    Kelas untuk mengimplementasikan Vigenere Cipher.
    Menerapkan prinsip PBO (enkapsulasi dan metode).
    """

    def __init__(self, key):
        """Konstruktor kelas dengan kunci (key) sebagai atribut."""
        # Membersihkan kunci dari karakter non-alfabet dan mengubah ke huruf kapital
        self.key = "".join(filter(str.isalpha, key)).upper()
        if not self.key:
            raise ValueError("Kunci VigenÃ¨re tidak boleh kosong setelah dibersihkan.")
        print(f"ğŸ”‘ Kunci yang digunakan: {self.key}")
        print("-" * 40)

    def _get_key_stream(self, text):
        """Membuat stream kunci (key stream) yang sesuai panjang teks."""
        text_len = len("".join(filter(str.isalpha, text)))
        key_stream = ""
        key_len = len(self.key)
        
        # Ulangi kunci sesuai panjang teks
        for i in range(text_len):
            key_stream += self.key[i % key_len]
        return key_stream

    def encrypt(self, plaintext):
        """Melakukan proses enkripsi VigenÃ¨re Cipher."""
        
        # Membersihkan plaintext dan mengubah ke huruf kapital untuk proses
        processed_text = "".join(filter(str.isalpha, plaintext)).upper()
        key_stream = self._get_key_stream(processed_text)
        
        ciphertext = ""
        detail_proses = []
        key_index = 0

        for char_plaintext in plaintext.upper():
            if 'A' <= char_plaintext <= 'Z':
                # Dapatkan nilai numerik (0-25) untuk huruf
                p = ord(char_plaintext) - ord('A')
                k = ord(key_stream[key_index]) - ord('A')
                
                # Rumus Enkripsi: C = (P + K) mod 26
                c = (p + k) % 26
                char_ciphertext = chr(c + ord('A'))
                
                # Menyimpan detail proses
                detail_proses.append(
                    f"{char_plaintext} (P={p}) + {key_stream[key_index]} (K={k}) = {char_ciphertext} (C={c})"
                )
                
                ciphertext += char_ciphertext
                key_index += 1
            else:
                # Mempertahankan karakter non-alfabet (spasi, tanda baca, dll.)
                ciphertext += char_plaintext
                
        return ciphertext, detail_proses

    def decrypt(self, ciphertext):
        """Melakukan proses dekripsi VigenÃ¨re Cipher."""
        
        # Membersihkan ciphertext dan mengubah ke huruf kapital untuk proses
        processed_text = "".join(filter(str.isalpha, ciphertext)).upper()
        key_stream = self._get_key_stream(processed_text)
        
        plaintext = ""
        detail_proses = []
        key_index = 0

        for char_ciphertext in ciphertext.upper():
            if 'A' <= char_ciphertext <= 'Z':
                # Dapatkan nilai numerik (0-25) untuk huruf
                c = ord(char_ciphertext) - ord('A')
                k = ord(key_stream[key_index]) - ord('A')
                
                # Rumus Dekripsi: P = (C - K) mod 26
                p = (c - k) % 26
                char_plaintext = chr(p + ord('A'))
                
                # Menyimpan detail proses
                detail_proses.append(
                    f"{char_ciphertext} (C={c}) - {key_stream[key_index]} (K={k}) = {char_plaintext} (P={p})"
                )
                
                plaintext += char_plaintext
                key_index += 1
            else:
                # Mempertahankan karakter non-alfabet
                plaintext += char_ciphertext

        return plaintext, detail_proses

# --- Contoh Penggunaan ---

# 1. Inisialisasi Kunci
KUNCI = "CRYPTOGRAPHY"
pesan_rahasia = VigenereCipher(KUNCI)

# --- ENKRIPSI ---
print("## ğŸ”’ Proses Enkripsi")
input_plaintext = "ROHANA LABORA MUNTHE"
print(f"**Plaintext (Teks Asli):** {input_plaintext}")

ciphertext, detail_enkripsi = pesan_rahasia.encrypt(input_plaintext)

print("\n--- Detail Proses Enkripsi ---")
for detail in detail_enkripsi:
    print(detail)

print(f"\n**Ciphertext (Teks Terenkripsi):** {ciphertext}")

print("\n" + "=" * 50 + "\n")

# --- DEKRIPSI ---
print("## ğŸ”“ Proses Dekripsi")
print(f"**Ciphertext (Teks Terenkripsi):** {ciphertext}")

decrypted_plaintext, detail_dekripsi = pesan_rahasia.decrypt(ciphertext)

print("\n--- Detail Proses Dekripsi ---")
for detail in detail_dekripsi:
    print(detail)

print(f"\n**Decrypted Plaintext (Hasil Dekripsi):** {decrypted_plaintext}")