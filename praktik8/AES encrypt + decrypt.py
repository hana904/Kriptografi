import tkinter as tk
from tkinter import ttk, messagebox

# ============================================================
#                     AES S-BOX & INV S-BOX
# ============================================================
SBOX = [
0x63,0x7C,0x77,0x7B,0xF2,0x6B,0x6F,0xC5,0x30,0x01,0x67,0x2B,0xFE,0xD7,0xAB,0x76,
0xCA,0x82,0xC9,0x7D,0xFA,0x59,0x47,0xF0,0xAD,0xD4,0xA2,0xAF,0x9C,0xA4,0x72,0xC0,
0xB7,0xFD,0x93,0x26,0x36,0x3F,0xF7,0xCC,0x34,0xA5,0xE5,0xF1,0x71,0xD8,0x31,0x15,
0x04,0xC7,0x23,0xC3,0x18,0x96,0x05,0x9A,0x07,0x12,0x80,0xE2,0xEB,0x27,0xB2,0x75,
0x09,0x83,0x2C,0x1A,0x1B,0x6E,0x5A,0xA0,0x52,0x3B,0xD6,0xB3,0x29,0xE3,0x2F,0x84,
0x53,0xD1,0x00,0xED,0x20,0xFC,0xB1,0x5B,0x6A,0xCB,0xBE,0x39,0x4A,0x4C,0x58,0xCF,
0xD0,0xEF,0xAA,0xFB,0x43,0x4D,0x33,0x85,0x45,0xF9,0x02,0x7F,0x50,0x3C,0x9F,0xA8,
0x51,0xA3,0x40,0x8F,0x92,0x9D,0x38,0xF5,0xBC,0xB6,0xDA,0x21,0x10,0xFF,0xF3,0xD2,
0xCD,0x0C,0x13,0xEC,0x5F,0x97,0x44,0x17,0xC4,0xA7,0x7E,0x3D,0x64,0x5D,0x19,0x73,
0x60,0x81,0x4F,0xDC,0x22,0x2A,0x90,0x88,0x46,0xEE,0xB8,0x14,0xDE,0x5E,0x0B,0xDB,
0xE0,0x32,0x3A,0x0A,0x49,0x06,0x24,0x5C,0xC2,0xD3,0xAC,0x62,0x91,0x95,0xE4,0x79,
0xE7,0xC8,0x37,0x6D,0x8D,0xD5,0x4E,0xA9,0x6C,0x56,0xF4,0xEA,0x65,0x7A,0xAE,0x08,
0xBA,0x78,0x25,0x2E,0x1C,0xA6,0xB4,0xC6,0xE8,0xDD,0x74,0x1F,0x4B,0xBD,0x8B,0x8A,
0x70,0x3E,0xB5,0x66,0x48,0x03,0xF6,0x0E,0x61,0x35,0x57,0xB9,0x86,0xC1,0x1D,0x9E,
0xE1,0xF8,0x98,0x11,0x69,0xD9,0x8E,0x94,0x9B,0x1E,0x87,0xE9,0xCE,0x55,0x28,0xDF,
0x8C,0xA1,0x89,0x0D,0xBF,0xE6,0x42,0x68,0x41,0x99,0x2D,0x0F,0xB0,0x54,0xBB,0x16
]

INV_SBOX = [
0x52,0x09,0x6A,0xD5,0x30,0x36,0xA5,0x38,0xBF,0x40,0xA3,0x9E,0x81,0xF3,0xD7,0xFB,
0x7C,0xE3,0x39,0x82,0x9B,0x2F,0xFF,0x87,0x34,0x8E,0x43,0x44,0xC4,0xDE,0xE9,0xCB,
0x54,0x7B,0x94,0x32,0xA6,0xC2,0x23,0x3D,0xEE,0x4C,0x95,0x0B,0x42,0xFA,0xC3,0x4E,
0x08,0x2E,0xA1,0x66,0x28,0xD9,0x24,0xB2,0x76,0x5B,0xA2,0x49,0x6D,0x8B,0xD1,0x25,
0x72,0xF8,0xF6,0x64,0x86,0x68,0x98,0x16,0xD4,0xA4,0x5C,0xCC,0x5D,0x65,0xB6,0x92,
0x6C,0x70,0x48,0x50,0xFD,0xED,0xB9,0xDA,0x5E,0x15,0x46,0x57,0xA7,0x8D,0x9D,0x84,
0x90,0xD8,0xAB,0x00,0x8C,0xBC,0xD3,0x0A,0xF7,0xE4,0x58,0x05,0xB8,0xB3,0x45,0x06,
0xD0,0x2C,0x1E,0x8F,0xCA,0x3F,0x0F,0x02,0xC1,0xAF,0xBD,0x03,0x01,0x13,0x8A,0x6B,
0x3A,0x91,0x11,0x41,0x4F,0x67,0xDC,0xEA,0x97,0xF2,0xCF,0xCE,0xF0,0xB4,0xE6,0x73,
0x96,0xAC,0x74,0x22,0xE7,0xAD,0x35,0x85,0xE2,0xF9,0x37,0xE8,0x1C,0x75,0xDF,0x6E,
0x47,0xF1,0x1A,0x71,0x1D,0x29,0xC5,0x89,0x6F,0xB7,0x62,0x0E,0xAA,0x18,0xBE,0x1B,
0xFC,0x56,0x3E,0x4B,0xC6,0xD2,0x79,0x20,0x9A,0xDB,0xC0,0xFE,0x78,0xCD,0x5A,0xF4,
0x1F,0xDD,0xA8,0x33,0x88,0x07,0xC7,0x31,0xB1,0x12,0x10,0x59,0x27,0x80,0xEC,0x5F,
0x60,0x51,0x7F,0xA9,0x19,0xB5,0x4A,0x0D,0x2D,0xE5,0x7A,0x9F,0x93,0xC9,0x9C,0xEF,
0xA0,0xE0,0x3B,0x4D,0xAE,0x2A,0xF5,0xB0,0xC8,0xEB,0xBB,0x3C,0x83,0x53,0x99,0x61,
0x17,0x2B,0x04,0x7E,0xBA,0x77,0xD6,0x26,0xE1,0x69,0x14,0x63,0x55,0x21,0x0C,0x7D
]

# ============================================================
#                        AES FUNCTIONS
# ============================================================
def pad_pkcs7(text):
    data=[ord(c) for c in text]
    pad_len=16-(len(data)%16)
    return data+[pad_len]*pad_len

def unpad_pkcs7(data):
    return data[:-data[-1]]

def bytes_to_matrix(b):
    return [b[i:i+4] for i in range(0,16,4)]

def matrix_to_bytes(m):
    return [b for r in m for b in r]

def add_round_key(s,k):
    return [[a^b for a,b in zip(x,y)] for x,y in zip(s,k)]

def sub_bytes(s):
    return [[SBOX[b] for b in row] for row in s]

def inv_sub_bytes(s):
    return [[INV_SBOX[b] for b in row] for row in s]

def shift_rows(s):
    return [s[0], s[1][1:]+s[1][:1], s[2][2:]+s[2][:2], s[3][3:]+s[3][:3]]

def inv_shift_rows(s):
    return [s[0], s[1][-1:]+s[1][:-1], s[2][-2:]+s[2][:-2], s[3][-3:]+s[3][:-3]]

def xtime(a):
    return ((a<<1)^0x1B)&0xFF if a&0x80 else (a<<1)

def mix_single_column(c):
    a=c; b=[xtime(x) for x in a]
    return [
        b[0]^a[3]^a[2]^b[1]^a[1],
        b[1]^a[0]^a[3]^b[2]^a[2],
        b[2]^a[1]^a[0]^b[3]^a[3],
        b[3]^a[2]^a[1]^b[0]^a[0]
    ]

def mix_columns(s):
    cols= list(zip(*s))
    m    =[mix_single_column(list(c)) for c in cols]
    return [list(x) for x in zip(*m)]

def mul(a,b):
    r=0
    for _ in range(8):
        if b&1: r^=a
        h=a&0x80
        a=(a<<1)&0xFF
        if h: a^=0x1B
        b>>=1
    return r

def inv_mix_single_column(c):
    return [
        mul(c[0],14)^mul(c[1],11)^mul(c[2],13)^mul(c[3],9),
        mul(c[0],9)^mul(c[1],14)^mul(c[2],11)^mul(c[3],13),
        mul(c[0],13)^mul(c[1],9)^mul(c[2],14)^mul(c[3],11),
        mul(c[0],11)^mul(c[1],13)^mul(c[2],9)^mul(c[3],14)
    ]

def inv_mix_columns(s):
    cols= list(zip(*s))
    m    =[inv_mix_single_column(list(c)) for c in cols]
    return [list(x) for x in zip(*m)]

RCON=[1,2,4,8,16,32,64,128,27,54]

def key_expansion(key):
    w=[key[i:i+4] for i in range(0,16,4)]
    for i in range(4,44):
        t=w[i-1]
        if i%4==0:
            t=t[1:]+t[:1]
            t=[SBOX[x] for x in t]
            t[0]^=RCON[(i//4)-1]
        w.append([t[j]^w[i-4][j] for j in range(4)])
    return [w[i:i+4] for i in range(0,44,4)]

def aes_encrypt_block(b,rk):
    s=bytes_to_matrix(b)
    s=add_round_key(s,rk[0])
    for r in range(1,10):
        s=sub_bytes(s)
        s=shift_rows(s)
        s=mix_columns(s)
        s=add_round_key(s,rk[r])
    s=sub_bytes(s)
    s=shift_rows(s)
    s=add_round_key(s,rk[10])
    return matrix_to_bytes(s)

def aes_decrypt_block(b,rk):
    s=bytes_to_matrix(b)
    s=add_round_key(s,rk[10])
    for r in range(9,0,-1):
        s=inv_shift_rows(s)
        s=inv_sub_bytes(s)
        s=add_round_key(s,rk[r])
        s=inv_mix_columns(s)
    s=inv_shift_rows(s)
    s=inv_sub_bytes(s)
    s=add_round_key(s,rk[0])
    return matrix_to_bytes(s)


# ============================================================
#                       UI FUNCTIONS
# ============================================================
def encrypt():
    text = entry_plain.get()
    key  = entry_key.get()

    if text == "" or key == "":
        messagebox.showwarning("Warning", "Isi plaintext dan key!")
        return

    pb = pad_pkcs7(text)
    kb = [ord(c) for c in key]
    kb = (kb + [0]*16)[:16]

    rk = key_expansion(kb)

    cipher=[]
    for i in range(0,len(pb),16):
        cipher+=aes_encrypt_block(pb[i:i+16],rk)

    output_cipher_hex.delete("1.0", tk.END)
    output_cipher_hex.insert(tk.END, " ".join(f"{x:02X}" for x in cipher))

def decrypt():
    key  = entry_key.get()
    hex_data = output_cipher_hex.get("1.0", tk.END).strip()

    if hex_data == "":
        messagebox.showwarning("Warning", "Tidak ada ciphertext!")
        return

    cipher = [int(h,16) for h in hex_data.split()]

    kb=[ord(c) for c in key]
    kb=(kb+[0]*16)[:16]

    rk = key_expansion(kb)

    dec=[]
    for i in range(0,len(cipher),16):
        dec+=aes_decrypt_block(cipher[i:i+16],rk)

    try:
        text = "".join(chr(x) for x in unpad_pkcs7(dec))
    except:
        text = "ERROR: Key salah / data rusak"

    output_decrypt.delete("1.0", tk.END)
    output_decrypt.insert(tk.END, text)


# ============================================================
#                       USER INTERFACE
# ============================================================
root = tk.Tk()
root.title("AES Encryption - Kriptografi")
root.geometry("650x500")
root.configure(bg="#E8F0FF")

title = tk.Label(root, text="AES Encryption (UI) - 128 bit", font=("Segoe UI", 16, "bold"), bg="#E8F0FF", fg="#1A3E72")
title.pack(pady=10)

frame = tk.Frame(root, bg="#E8F0FF")
frame.pack()

# Input plaintext
lbl_plain = tk.Label(frame, text="Plaintext:", font=("Segoe UI", 11), bg="#E8F0FF")
lbl_plain.grid(row=0, column=0, sticky="w")
entry_plain = tk.Entry(frame, width=55, font=("Segoe UI", 11))
entry_plain.grid(row=0, column=1, padx=10, pady=5)

# Input key
lbl_key = tk.Label(frame, text="Key:", font=("Segoe UI", 11), bg="#E8F0FF")
lbl_key.grid(row=1, column=0, sticky="w")
entry_key = tk.Entry(frame, width=55, font=("Segoe UI", 11))
entry_key.grid(row=1, column=1, padx=10, pady=5)

# Buttons
btn_encrypt = tk.Button(frame, text="ENCRYPT", font=("Segoe UI", 11, "bold"),
                        bg="#5C80BC", fg="white", width=12, command=encrypt)
btn_encrypt.grid(row=2, column=0, pady=10, padx=5)

btn_decrypt = tk.Button(frame, text="DECRYPT", font=("Segoe UI", 11, "bold"),
                        bg="#5C80BC", fg="white", width=12, command=decrypt)
btn_decrypt.grid(row=2, column=1, pady=10, padx=5, sticky="w")

# Output ciphertext
lbl_cipher = tk.Label(root, text="Ciphertext (HEX):", font=("Segoe UI", 11), bg="#E8F0FF")
lbl_cipher.pack()
output_cipher_hex = tk.Text(root, height=4, width=75, font=("Consolas", 11))
output_cipher_hex.pack(pady=5)

# Output decrypt
lbl_dec = tk.Label(root, text="Hasil Dekripsi:", font=("Segoe UI", 11), bg="#E8F0FF")
lbl_dec.pack()
output_decrypt = tk.Text(root, height=3, width=75, font=("Segoe UI", 11))
output_decrypt.pack(pady=5)

# Catatan *Nama*
catatan = tk.Label(root, text="Rohana (230840041)", font=("Segoe UI", 13, "italic"),
                   bg="#E8F0FF", fg="#2C4A77")
catatan.pack(side="bottom", pady=10)

root.mainloop()
